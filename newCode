import openpyxl
import json

def load_test_cases(file_path):
    # Load the Excel file using openpyxl
    workbook = openpyxl.load_workbook(file_path)
    sheet = workbook.active

    # Read the headers from the first row
    headers = [cell.value for cell in sheet[1]]

    # Prepare a list to hold the rows
    test_cases = []
    
    # Read each subsequent row of the Excel sheet
    for row in sheet.iter_rows(min_row=2, values_only=True):
        test_case = dict(zip(headers, row))
        test_cases.append(test_case)
    
    return test_cases

def create_test_data(test_cases):
    # Dictionary to hold structured test case data
    test_data = {}
    
    current_summary = ""
    
    for row in test_cases:
        # Update the current summary if it changes
        if row['Summary']:
            current_summary = row['Summary']
        
        # If current_summary exists, create a test case entry
        if current_summary:
            if current_summary not in test_data:
                test_data[current_summary] = {
                    "test_steps": []
                }
        
            # Add the test step, expected result, and test data
            test_data[current_summary]["test_steps"].append({
                "test_step": row['Test Step'],
                "expected_result": row['Expected Result'],
                "test_data": row['Test Data']
            })
    
    return test_data

def save_test_data(test_data, output_file):
    # Save the test data to a JSON file
    with open(output_file, 'w') as outfile:
        json.dump(test_data, outfile, indent=4)

def main():
    file_path = "test_cases.xlsx"  # Replace with your Excel file path
    output_file = "test_data.json"  # The file where test data will be saved
    
    test_cases = load_test_cases(file_path)
    test_data = create_test_data(test_cases)
    
    # Save the test data set to a file
    save_test_data(test_data, output_file)
    
    print(f"Test data set saved to {output_file}")

if __name__ == "__main__":
    main()

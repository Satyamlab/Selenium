def remove_empty_fields(data):
    """
    Recursively remove keys with None, empty lists, or empty dictionaries.
    Also, remove dictionaries where all keys have None or empty values.
    """
    if isinstance(data, dict):
        # Process each key-value pair
        cleaned_data = {
            k: remove_empty_fields(v)
            for k, v in data.items()
            if v not in [None, {}, []]
        }
        # Remove the dict itself if all its keys are removed or are None/empty
        if not cleaned_data or all(value in [None, {}, []] for value in cleaned_data.values()):
            return None
        return cleaned_data
    elif isinstance(data, list):
        # Recursively clean lists and remove empty items
        cleaned_list = [remove_empty_fields(v) for v in data if v not in [None, {}, []]]
        return cleaned_list if cleaned_list else None
    return data  # Return the value if it's not a dict or list

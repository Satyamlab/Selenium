def remove_empty_fields(data):
    """
    Recursively remove keys with None, empty lists, or empty dictionaries.
    Remove dictionaries where all nested keys are None or empty.
    """
    if isinstance(data, dict):
        # Clean each key-value pair recursively
        cleaned_data = {
            k: remove_empty_fields(v)
            for k, v in data.items()
            if v not in [None, {}, []]  # Remove direct None, {}, or []
        }
        # If all keys in the dictionary are empty after cleaning, remove the dict itself
        return cleaned_data if cleaned_data else None
    elif isinstance(data, list):
        # Clean each item in the list recursively
        cleaned_list = [remove_empty_fields(v) for v in data if v not in [None, {}, []]]
        return cleaned_list if cleaned_list else None
    return data  # Return the value if it's not a dict or list
